<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprinter P02D0 + P0299 ‰∫íÂãïÂºèË®∫Êñ∑Âä©ÁêÜ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: A task-oriented "Diagnostic Assistant" SPA. It starts with a high-level visual explanation of the core problem (causal chain), then guides the user through a prioritized, tabbed interactive diagnostic checklist (Air System -> Exhaust -> etc.). A key feature is the "Symptom Analyzer," an interactive radar chart that allows users to select observed symptoms to visually pinpoint the most likely fault systems, dynamically linking symptoms to the diagnostic checklist. The app concludes with preventative maintenance tips. This structure was chosen to transform a static report into an active, guided tool, making the complex diagnostic process more manageable, intuitive, and efficient for a user who needs to solve a problem, rather than just read about it. -->
    <!-- Visualization & Content Choices: 
        - Causal Chain (Inform): Presented as a simple, clear HTML/CSS flow diagram with Unicode arrows. This avoids library overhead and directly communicates the core concept.
        - Symptom Analyzer (Relationships/Compare): A Chart.js Radar Chart. Goal: To visually correlate user-selected symptoms with potential root causes. Interaction: User clicks symptom buttons, JS updates chart data, providing instant visual feedback. Justification: More engaging and insightful than a static table, providing a "smart tool" feel.
        - Diagnostic Steps (Organize/Guide): A tabbed interface with expandable detail cards. Goal: To break down the complex diagnostic procedure into logical, prioritized steps. Interaction: Users click tabs to navigate systems and click cards to see details. Justification: Manages complexity and guides the user through the most likely fixes first.
        - Maintenance Tips (Inform): Styled HTML cards. Goal: To present actionable advice clearly. Interaction: Simple hover effects. Justification: Easy to scan and digest.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif', 'ÂæÆËªüÊ≠£ÈªëÈ´î', 'Microsoft JhengHei';
            background-color: #f8f7f2;
            color: #333333;
        }
        .tab-active {
            border-color: #5F7A8D;
            background-color: #5F7A8D;
            color: #ffffff;
            font-weight: 600;
        }
        .tab-inactive {
            background-color: #e2e8f0;
            color: #4a5568;
        }
        .symptom-btn-active {
            background-color: #C77D55;
            color: #ffffff;
            border-color: #C77D55;
            transform: scale(1.05);
        }
        .symptom-btn-inactive {
             background-color: #ffffff;
             color: #4a5568;
             border-color: #cbd5e0;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .content-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }
        .content-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .flow-step {
            flex: 1;
            min-width: 120px;
        }
        .flow-arrow {
            color: #C77D55;
        }
        .lang-btn-active {
            background-color: #5F7A8D;
            color: white;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="text-center mb-10 relative">
            <div class="absolute top-0 right-0">
                <div id="lang-switcher" class="flex border border-gray-300 rounded-lg">
                    <button id="lang-zh" class="px-3 py-1 text-sm rounded-l-md">ÁπÅÈ´î‰∏≠Êñá</button>
                    <button id="lang-en" class="px-3 py-1 text-sm rounded-r-md">English</button>
                </div>
            </div>
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-gray-800"></h1>
            <h2 id="subtitle" class="text-2xl md:text-3xl font-semibold text-[#5F7A8D]"></h2>
            <p id="header-desc" class="mt-2 text-gray-600 max-w-3xl mx-auto"></p>
        </header>

        <main>
            <!-- Section 1: Problem Overview -->
            <section id="overview" class="mb-12">
                <div class="content-card p-6">
                    <h3 id="overview-title" class="text-xl font-bold mb-4 text-[#5F7A8D] flex items-center"></h3>
                    <p id="overview-desc" class="text-gray-700 mb-6"></p>
                    <div id="overview-flow" class="flex flex-wrap items-center justify-center gap-4 text-center text-sm md:text-base">
                        <!-- Flow steps generated by JS -->
                    </div>
                </div>
            </section>

            <!-- Section 2: Symptom Analyzer -->
            <section id="symptom-analyzer" class="mb-12">
                <div class="content-card p-6">
                    <h3 id="symptom-analyzer-title" class="text-xl font-bold mb-2 text-[#5F7A8D] flex items-center"></h3>
                    <p id="symptom-analyzer-desc" class="text-gray-700 mb-4"></p>
                    <div id="symptom-buttons" class="flex flex-wrap gap-2 mb-6">
                        <!-- Symptom buttons will be generated here by JS -->
                    </div>
                    <div class="chart-container">
                        <canvas id="symptom-chart"></canvas>
                    </div>
                </div>
            </section>


            <!-- Section 3: Interactive Diagnostic Flow -->
            <section id="diagnostic-flow" class="mb-12">
                <div class="content-card p-6">
                     <h3 id="diagnostic-flow-title" class="text-xl font-bold mb-4 text-[#5F7A8D] flex items-center"></h3>
                    <div class="w-full">
                        <nav id="diagnostic-tabs" class="flex border-b border-gray-200 mb-6 overflow-x-auto">
                            <!-- Tabs will be generated here -->
                        </nav>
                        <div id="diagnostic-content">
                            <!-- Content for tabs will be generated here -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section 4: Preventative Maintenance -->
            <section id="maintenance">
                 <div class="content-card p-6">
                    <h3 id="maintenance-title" class="text-xl font-bold mb-4 text-[#5F7A8D] flex items-center"></h3>
                    <div id="maintenance-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Maintenance cards will be generated here by JS -->
                    </div>
                 </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const translations = {
                en: {
                    mainTitle: "Mercedes-Benz Sprinter",
                    subtitle: "P02D0 + P0299 Interactive Diagnostic Assistant",
                    headerDesc: "This tool will guide you to systematically find the root cause. Remember: P02D0 is often a result of P0299.",
                    overviewTitle: "üí° Fault Cascade: How Does It Happen?",
                    overviewDesc: "These two codes appearing together form a typical 'cascade failure'. The root cause is usually 'unmetered air' entering the engine, causing the computer's fuel trim to reach its limit. This is not an injector problem, but the final result of an imbalanced air management system.",
                    flowSteps: [
                        { title: "1. Boost Leak", subtitle: "(Start of P0299)" },
                        { title: "2. Lean Air-Fuel Ratio", subtitle: "(Too much air)" },
                        { title: "3. ECU Correction Fails", subtitle: "(Incorrect judgment)" },
                        { title: "4. Injection at Min. Limit", subtitle: "(Triggers P02D0)" }
                    ],
                    symptomAnalyzerTitle: "üìà Symptom Correlation Analyzer",
                    symptomAnalyzerDesc: "Click on the symptoms you observe. The radar chart below will instantly analyze the most likely fault sources and suggest which system to check first.",
                    diagnosticFlowTitle: "üõ†Ô∏è Interactive Diagnostic Flow",
                    maintenanceTitle: "üõ°Ô∏è Preventative Maintenance & Long-Term Reliability",
                    chartLabel: "Fault Likelihood Score",
                    systems: [
                        { id: 'air', name: 'Air Management System (Top Priority)', checks: [ { title: 'Intake & Boost Leak Test (Smoke Test)', details: 'This is the most common cause. Use a smoke machine to check all pipes from the air filter to the intake manifold.' }, { title: 'Intercooler Hose Inspection', details: 'Check red and other hoses for cracks, swelling, or oil saturation, especially at bends.' }, { title: 'Turbo Resonator Inspection', details: 'Check the stock plastic resonator for cracks at the seams. Many owners upgrade to a more durable aluminum part.' }, { title: 'Intake Manifold & Gasket Inspection', details: 'Check the plastic intake manifold body for cracks and for failed, aging gaskets.' } ] },
                        { id: 'exhaust', name: 'Exhaust & Emissions System', checks: [ { title: 'DPF Differential Pressure Sensor Test', details: 'Use a scan tool to check pressure readings at idle and during acceleration. Check connecting hoses for melting or blockages. A bad reading can simulate a clogged DPF.' }, { title: 'EGR Valve Function Test & Cleaning', details: 'Use a scan tool to actively test valve opening and closing. Removal and cleaning of carbon buildup is crucial preventive maintenance. A stuck EGR severely impacts performance.' }, { title: 'Exhaust System Visual Inspection', details: 'Check for black soot marks around the exhaust manifold or turbo, indicating an exhaust leak.' } ] },
                        { id: 'control', name: 'Turbo Control & Sensors', checks: [ { title: 'Electronic Turbo Actuator Inspection', details: 'A common failure point. Worn internal gears prevent precise boost control, causing P0299. Often requires professional repair.' }, { title: 'VNT/Wastegate Linkage Check', details: 'Manually check if the control linkage is stuck due to carbon buildup.' }, { title: 'Turbo Pressure Transducer Inspection', details: 'Failure of this small, vacuum-controlled part can cause intermittent limp mode.' }, { title: 'MAP/MAF Sensor Rationality Check', details: 'With ignition on, engine off, compare MAP and atmospheric pressure readings. Observe if MAF data increases smoothly with acceleration.' } ] },
                        { id: 'advanced', name: 'Advanced Diagnostics', checks: [ { title: 'Harness Oil Contamination Check', details: 'Disconnect ECU and camshaft sensor connectors to check for oil wicking. Oil can disrupt signals, causing various strange electronic faults.' }, { title: 'Injector IQA Code Verification', details: 'Ensure the calibration code for each injector is correctly programmed into the ECU. Incorrect codes lead to faulty fuel calculations.' }, { title: 'Fuel System Pressure Check', details: 'As a final step, use a scan tool to check if low and high fuel pressures are within spec under load.' } ] }
                    ],
                    symptoms: [
                        { id: 'limp_mode', name: 'Limp mode when going uphill', causes: ['air', 'exhaust', 'control'] }, { id: 'hissing_sound', name: 'Hissing/whistling from engine bay', causes: ['air'] }, { id: 'black_smoke', name: 'Black smoke from exhaust', causes: ['exhaust', 'air'] }, { id: 'rough_idle', name: 'Rough or unstable idle', causes: ['air', 'exhaust', 'control', 'advanced'] }, { id: 'poor_mpg', name: 'Significant drop in fuel economy', causes: ['exhaust', 'air', 'control'] }, { id: 'code_migrate', name: 'Fault code migrates between cylinders', causes: ['air', 'advanced'] }, { id: 'poor_accel', name: 'Sluggish acceleration, lack of power', causes: ['air', 'exhaust', 'control'] }
                    ],
                    maintenance: [
                        { title: 'Optimize Driving Habits', details: 'Avoid frequent short trips. Regular highway driving helps the DPF complete its regeneration cycle.', icon: 'üõ£Ô∏è' }, { title: 'Use Correct Oil', details: 'Always use Low-SAPS oil that meets Mercedes specs to protect the DPF.', icon: 'üíß' }, { title: 'Regular EGR Cleaning', details: 'It is recommended to clean the EGR valve every 50k-80k km to prevent carbon buildup.', icon: 'üßº' }, { title: 'Proactive Upgrades', details: 'Consider replacing the plastic turbo resonator with an aluminum one for a permanent fix.', icon: 'üî©' }
                    ]
                },
                zh: {
                    mainTitle: "Mercedes-Benz Sprinter",
                    subtitle: "P02D0 + P0299 ‰∫íÂãïÂºèË®∫Êñ∑Âä©ÁêÜ",
                    headerDesc: "ÈÄô‰ªΩÂ∑•ÂÖ∑Â∞áÂºïÂ∞éÊÇ®Á≥ªÁµ±ÊÄßÂú∞ÊâæÂá∫ÂïèÈ°åÊ†πÊ∫ê„ÄÇË´ãË®ò‰ΩèÔºöP02D0 ÈÄöÂ∏∏ÊòØ P0299 ÊâÄÂºïÁôºÁöÑÁµêÊûú„ÄÇ",
                    overviewTitle: "üí° ÊïÖÈöúÈÄ£ÈéñÂèçÊáâÔºöÂïèÈ°åÊòØÂ¶Ç‰ΩïÁôºÁîüÁöÑÔºü",
                    overviewDesc: "ÈÄôÂÖ©ÂÄãÊïÖÈöúÁ¢ºÂêåÊôÇÂá∫ÁèæÔºåÂΩ¢Êàê‰∫Ü‰∏ÄÂÄãÂÖ∏ÂûãÁöÑ„ÄåÈÄ£ÈéñÊïÖÈöú„Äç„ÄÇÊ†πÊú¨ÂéüÂõ†ÈÄöÂ∏∏ÊòØ„ÄåÊú™Ë¢´Ë®àÁÆóÁöÑÁ©∫Ê∞£„ÄçÈÄ≤ÂÖ•ÂºïÊìéÔºåÂ∞éËá¥ÈõªËÖ¶ÁöÑÁáÉÊ≤π‰øÆÊ≠£ÈÅîÂà∞Ê•µÈôê„ÄÇÈÄô‰∏çÊòØÂô¥Ê≤πÂò¥ÁöÑÂïèÈ°åÔºåËÄåÊòØÁ©∫Ê∞£ÁÆ°ÁêÜÁ≥ªÁµ±Â§±Ë°°ÁöÑÊúÄÁµÇÁµêÊûú„ÄÇ",
                    flowSteps: [
                        { title: "1. Â¢ûÂ£ìÊ¥©Êºè", subtitle: "(P0299 ÁöÑËµ∑Èªû)" },
                        { title: "2. Á©∫ÁáÉÊØîÈÅéÁ®Ä", subtitle: "(Á©∫Ê∞£ÈÅéÂ§ö)" },
                        { title: "3. ECU ‰øÆÊ≠£Â§±Êïó", subtitle: "(ÈåØË™§Âà§Êñ∑)" },
                        { title: "4. Âô¥Ê≤πÈÅî‰∏ãÈôê", subtitle: "(Ëß∏Áôº P02D0)" }
                    ],
                    symptomAnalyzerTitle: "üìà ÁóáÁãÄÈóúËÅØÂàÜÊûêÂô®",
                    symptomAnalyzerDesc: "ÈªûÈÅ∏ÊÇ®ËßÄÂØüÂà∞ÁöÑÁóáÁãÄÔºå‰∏ãÊñπÁöÑÈõ∑ÈÅîÂúñÂ∞áÂç≥ÊôÇÂàÜÊûêÊúÄÂèØËÉΩÁöÑÊïÖÈöú‰æÜÊ∫êÔºå‰∏¶Âª∫Ë≠∞ÊÇ®ÂÑ™ÂÖàÊ™¢Êü•ÁöÑÁ≥ªÁµ±„ÄÇ",
                    diagnosticFlowTitle: "üõ†Ô∏è ‰∫íÂãïÂºèË®∫Êñ∑ÊµÅÁ®ã",
                    maintenanceTitle: "üõ°Ô∏è È†êÈò≤ÊÄßÁ∂≠Ë≠∑ËàáÈï∑ÊúüÂèØÈù†ÊÄßÂª∫Ë≠∞",
                    chartLabel: "ÊïÖÈöúÂèØËÉΩÊÄßË©ïÂàÜ",
                    systems: [
                        { id: 'air', name: 'Á©∫Ê∞£ÁÆ°ÁêÜÁ≥ªÁµ± (ÊúÄÈ´òÂÑ™ÂÖàÁ¥ö)', checks: [ { title: 'ÈÄ≤Ê∞£ËàáÂ¢ûÂ£ìÊ¥©ÊºèÊ™¢Ê∏¨ (ÁÖôÈúßÊ∏¨Ë©¶)', details: 'ÈÄôÊòØÊúÄÂ∏∏Ë¶ãÁöÑÂéüÂõ†„ÄÇ‰ΩøÁî®ÁÖôÈúßÊ∏¨Ë©¶Ê©üÊ™¢Êü•ÂæûÁ©∫Ê∞£ÊøæÊ∏ÖÂô®Âà∞ÈÄ≤Ê∞£Ê≠ßÁÆ°ÁöÑÊâÄÊúâÁÆ°Ë∑Ø„ÄÇ' }, { title: '‰∏≠ÂÜ∑Âô®ËªüÁÆ°Ê™¢Êü•', details: 'Ê™¢Êü•Á¥ÖËâ≤ÂèäÂÖ∂‰ªñËªüÁÆ°ÊòØÂê¶ÊúâÁ†¥Ë£Ç„ÄÅËÜ®ËÑπÊàñÊ≤πÊ±°Êµ∏ÊΩ§ÔºåÁâπÂà•ÊòØÂú®ÂΩéÊõ≤Ëôï„ÄÇ' }, { title: 'Ê∏¶Ëº™Ë´ßÊåØÂô®Ê™¢Êü•', details: 'Ê™¢Êü•ÂéüÂª†Â°ëËÜ†Ë´ßÊåØÂô®Êé•ÂêàËôïÊòØÂê¶ÊúâË£ÇÁ∏´„ÄÇË®±Â§öËªä‰∏ªÊúÉÂçáÁ¥öÁÇ∫Êõ¥ËÄêÁî®ÁöÑÈãÅÂêàÈáë‰ª∂„ÄÇ' }, { title: 'ÈÄ≤Ê∞£Ê≠ßÁÆ°ËàáÂ¢äÁâáÊ™¢Êü•', details: 'Ê™¢Êü•Â°ëËÜ†ÈÄ≤Ê∞£Ê≠ßÁÆ°Êú¨È´îÊòØÂê¶ÊúâË£ÇÁóïÔºå‰ª•ÂèäÂ¢äÁâáÊòØÂê¶ËÄÅÂåñÂ§±Êïà„ÄÇ' } ] },
                        { id: 'exhaust', name: 'ÊéíÊ∞£ËàáÊéíÊîæÁ≥ªÁµ±', checks: [ { title: 'DPF Â£ìÂ∑ÆÊÑüÁü•Âô®Ê∏¨Ë©¶', details: '‰ΩøÁî®Ë®∫Êñ∑ÂÑÄÂô®Ê™¢Êü•ÊÄ†ÈÄüÂíåÂä†ÈÄüÊôÇÁöÑÂ£ìÂäõËÆÄÊï∏„ÄÇÊ™¢Êü•ÈÄ£Êé•ËªüÁÆ°ÊòØÂê¶ÁÜîÂåñÊàñÂ†µÂ°û„ÄÇÈåØË™§ÁöÑËÆÄÊï∏ÊúÉÊ®°Êì¨ DPF Â†µÂ°û„ÄÇ' }, { title: 'EGR Èñ•ÂäüËÉΩÊ∏¨Ë©¶ËàáÊ∏ÖÊΩî', details: '‰ΩøÁî®Ë®∫Êñ∑ÂÑÄÂô®‰∏ªÂãïÊ∏¨Ë©¶Èñ•ÈñÄÈñãÈñâ„ÄÇÊãÜ‰∏ãÊ∏ÖÊΩîÁ©çÁ¢≥ÊòØÈáçË¶ÅÁöÑÈ†êÈò≤ÊÄß‰øùÈ§ä„ÄÇÂç°ÊªØÁöÑ EGR ÊúÉÂö¥ÈáçÂΩ±ÈüøÊÄßËÉΩ„ÄÇ' }, { title: 'ÊéíÊ∞£Á≥ªÁµ±ÁõÆË¶ñÊ™¢Êü•', details: 'Ê™¢Êü•ÊéíÊ∞£Ê≠ßÁÆ°ÊàñÊ∏¶Ëº™Âë®ÂúçÊòØÂê¶ÊúâÈªëÁÖôÁÅ∞ÁóïË∑°ÔºåÈÄôË°®Á§∫Â≠òÂú®ÊéíÊ∞£Ê¥©Êºè„ÄÇ' } ] },
                        { id: 'control', name: 'Ê∏¶Ëº™ÊéßÂà∂ËàáÊÑüÁü•Âô®', checks: [ { title: 'ÈõªÂ≠êÊ∏¶Ëº™‰ΩúÂãïÂô®Ê™¢Êü•', details: 'ÈÄôÊòØÂ∏∏Ë¶ãÊïÖÈöúÈªû„ÄÇÂÖßÈÉ®ÈΩíËº™Á£®ÊêçÊúÉÂ∞éËá¥ÁÑ°Ê≥ïÁ≤æÁ¢∫ÊéßÂà∂Â¢ûÂ£ìÔºåÂºïÁôº P0299„ÄÇÈÄöÂ∏∏ÈúÄË¶ÅÂ∞àÊ•≠‰øÆÂæ©„ÄÇ' }, { title: 'VNT/Âª¢Ê∞£ÈñÄÈÄ£Ê°øÊ™¢Êü•', details: 'ÊâãÂãïÊ™¢Êü•ÊéßÂà∂ÈÄ£Ê°øÊòØÂê¶Âõ†Á©çÁ¢≥ËÄåÂç°ÊªØ„ÄÇ' }, { title: 'Ê∏¶Ëº™Â£ìÂäõËΩâÊèõÂô®Ê™¢Êü•', details: 'ÈÄôÂÄãÁúüÁ©∫ÊéßÂà∂ÁöÑÂ∞èÈõ∂‰ª∂ÊïÖÈöúÊúÉÂ∞éËá¥ÈñìÊ≠áÊÄßÁöÑË∑õË°åÊ®°Âºè„ÄÇ' }, { title: 'MAP/MAF ÊÑüÁü•Âô®ÂêàÁêÜÊÄßÊ™¢Êü•', details: 'Âú®ÈªûÁÅ´Èñã„ÄÅÂºïÊìéÈóúÁöÑÁãÄÊÖã‰∏ãÔºåÊØîÂ∞ç MAP ÂíåÂ§ßÊ∞£Â£ìÂäõËÆÄÊï∏„ÄÇËßÄÂØüÊÄ†ÈÄüÂíåÂä†ÈÄüÊôÇ MAF Êï∏ÊìöÊòØÂê¶Âπ≥È†ÜÂ¢ûÂä†„ÄÇ' } ] },
                        { id: 'advanced', name: 'ÈÄ≤ÈöéË®∫Êñ∑', checks: [ { title: 'Á∑öÊùüÊ≤πÊ±°Êª≤ÈÄèÊ™¢Êü•', details: 'Êñ∑Èñã ECU ÂíåÂá∏Ëº™Ëª∏ÊÑüÁü•Âô®Êé•È†≠ÔºåÊ™¢Êü•ÊòØÂê¶ÊúâÊ©üÊ≤πÊª≤ÂÖ•„ÄÇÊ©üÊ≤πÊúÉÂπ≤Êìæ‰ø°ËôüÔºåÂ∞éËá¥ÂêÑÁ®ÆÂ•áÊÄ™ÁöÑÈõªÂ≠êÊïÖÈöú„ÄÇ' }, { title: 'Âô¥Ê≤πÂô® IQA Á∑®Á¢ºÈ©óË≠â', details: 'Á¢∫Ë™çÊØèÂÄãÂô¥Ê≤πÂô®ÁöÑÊ†°Ê∫ñÁ¢ºÂ∑≤Ê≠£Á¢∫ÂØ´ÂÖ• ECU„ÄÇÈåØË™§ÁöÑÁ∑®Á¢ºÊúÉÂ∞éËá¥ÁáÉÊ≤πË®àÁÆóÂ§±Ê∫ñ„ÄÇ' }, { title: 'ÁáÉÊ≤πÁ≥ªÁµ±Â£ìÂäõÊ™¢Êü•', details: '‰ΩúÁÇ∫ÊúÄÂæå‰∏ÄÊ≠•Ôºå‰ΩøÁî®Ë®∫Êñ∑ÂÑÄÂô®Ê™¢Êü•‰ΩéÂ£ìÂíåÈ´òÂ£ìÁáÉÊ≤πÂ£ìÂäõÂú®Ë≤†Ëºâ‰∏ãÊòØÂê¶Á¨¶ÂêàË¶èÊ†º„ÄÇ' } ] }
                    ],
                    symptoms: [
                        { id: 'limp_mode', name: '‰∏äÂù°ÊôÇÈÄ≤ÂÖ•Ë∑õË°åÊ®°Âºè', causes: ['air', 'exhaust', 'control'] }, { id: 'hissing_sound', name: 'ÂºïÊìéÂÆ§ÊúâÂò∂Âò∂/ÂòØÂè´ËÅ≤', causes: ['air'] }, { id: 'black_smoke', name: 'ÊéíÊ∞£ÁÆ°ÂÜíÈªëÁÖô', causes: ['exhaust', 'air'] }, { id: 'rough_idle', name: 'ÊÄ†ÈÄü‰∏çÁ©©ÊàñÊäñÂãï', causes: ['air', 'exhaust', 'control', 'advanced'] }, { id: 'poor_mpg', name: 'Ê≤πËÄóÈ°ØËëóÂ¢ûÂä†', causes: ['exhaust', 'air', 'control'] }, { id: 'code_migrate', name: 'ÊïÖÈöúÁ¢ºÂú®‰∏çÂêåÊ±ΩÁº∏ÈñìÈÅ∑Áßª', causes: ['air', 'advanced'] }, { id: 'poor_accel', name: 'Âä†ÈÄüÈÅ≤ÊªØ„ÄÅÁÑ°Âäõ', causes: ['air', 'exhaust', 'control'] }
                    ],
                    maintenance: [
                        { title: 'ÂÑ™ÂåñÈßïÈßõÁøíÊÖ£', details: 'ÈÅøÂÖçÈ†ªÁπÅÁü≠ÈÄîË°åÈßõÔºåÂÆöÊúü‰∏äÈ´òÈÄüÂÖ¨Ë∑ØÂπ´Âä© DPF ÂÆåÊàêÂÜçÁîü„ÄÇ', icon: 'üõ£Ô∏è' }, { title: '‰ΩøÁî®Ê≠£Á¢∫Ê©üÊ≤π', details: 'ÂãôÂøÖ‰ΩøÁî®Á¨¶ÂêàË≥ìÂ£´Ë¶èÁØÑÁöÑ Low-SAPS (‰ΩéÁ°´ÁÅ∞) Ê©üÊ≤π‰ª•‰øùË≠∑ DPF„ÄÇ', icon: 'üíß' }, { title: 'ÂÆöÊúüÊ∏ÖÊΩî EGR', details: 'Âª∫Ë≠∞ÊØè 5-8 Ëê¨ÂÖ¨ÈáåÊ∏ÖÊΩî‰∏ÄÊ¨° EGR Èñ•ÔºåÈ†êÈò≤Á©çÁ¢≥Âç°ÊªØ„ÄÇ', icon: 'üßº' }, { title: '‰∏ªÂãïÊÄßÂçáÁ¥ö', details: 'ËÄÉÊÖÆÂ∞áÂ°ëËÜ†Ê∏¶Ëº™Ë´ßÊåØÂô®Êõ¥ÊèõÁÇ∫ÈãÅÂêàÈáë‰ª∂Ôºå‰∏ÄÂãûÊ∞∏ÈÄ∏„ÄÇ', icon: 'üî©' }
                    ]
                }
            };

            let currentLanguage = 'zh';
            let activeSymptoms = new Set();
            let chart;
            let activeTabId = translations.zh.systems[0].id;

            function renderContent(lang) {
                const T = translations[lang];
                
                document.documentElement.lang = lang === 'zh' ? 'zh-TW' : 'en';
                document.title = T.subtitle;

                // Update headers
                document.getElementById('main-title').textContent = T.mainTitle;
                document.getElementById('subtitle').textContent = T.subtitle;
                document.getElementById('header-desc').textContent = T.headerDesc;

                // Update section titles
                document.getElementById('overview-title').innerHTML = `<span class="mr-2">üí°</span> ${T.overviewTitle}`;
                document.getElementById('overview-desc').textContent = T.overviewDesc;
                document.getElementById('symptom-analyzer-title').innerHTML = `<span class="mr-2">üìà</span> ${T.symptomAnalyzerTitle}`;
                document.getElementById('symptom-analyzer-desc').textContent = T.symptomAnalyzerDesc;
                document.getElementById('diagnostic-flow-title').innerHTML = `<span class="mr-2">üõ†Ô∏è</span> ${T.diagnosticFlowTitle}`;
                document.getElementById('maintenance-title').innerHTML = `<span class="mr-2">üõ°Ô∏è</span> ${T.maintenanceTitle}`;

                // Update language switcher style
                document.getElementById('lang-zh').classList.toggle('lang-btn-active', lang === 'zh');
                document.getElementById('lang-en').classList.toggle('lang-btn-active', lang === 'en');

                createOverviewFlow(T.flowSteps);
                createSymptomButtons(T.symptoms);
                createDiagnosticTabsAndContent(T.systems);
                createMaintenanceCards(T.maintenance);
                if (chart) chart.destroy();
                createChart(T);
                setActiveTab(activeTabId);
            }
            
            function createOverviewFlow(steps) {
                const container = document.getElementById('overview-flow');
                container.innerHTML = '';
                steps.forEach((step, index) => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `flow-step p-3 rounded-lg border ${index === 3 ? 'bg-red-50 border-red-200' : 'bg-gray-50 border-gray-200'}`;
                    stepDiv.innerHTML = `<p class="font-semibold ${index === 3 ? 'text-red-700' : ''}">${step.title}</p><p class="text-xs text-gray-500 ${index === 3 ? 'text-red-500' : ''}">${step.subtitle}</p>`;
                    container.appendChild(stepDiv);

                    if (index < steps.length - 1) {
                        const arrowDiv = document.createElement('div');
                        arrowDiv.className = 'flow-arrow font-bold text-2xl hidden md:block';
                        arrowDiv.textContent = '‚û°Ô∏è';
                        container.appendChild(arrowDiv);
                        const arrowDivMobile = document.createElement('div');
                        arrowDivMobile.className = 'flow-arrow font-bold text-2xl md:hidden w-full text-center';
                        arrowDivMobile.textContent = '‚¨áÔ∏è';
                        container.appendChild(arrowDivMobile);
                    }
                });
            }

            function createSymptomButtons(symptoms) {
                const container = document.getElementById('symptom-buttons');
                container.innerHTML = '';
                symptoms.forEach(symptom => {
                    const button = document.createElement('button');
                    button.textContent = symptom.name;
                    button.dataset.symptomId = symptom.id;
                    const isActive = activeSymptoms.has(symptom.id);
                    button.className = `py-2 px-4 rounded-full border text-sm font-semibold transition-all duration-200 ${isActive ? 'symptom-btn-active' : 'symptom-btn-inactive'}`;
                    button.addEventListener('click', () => toggleSymptom(symptom.id, button));
                    container.appendChild(button);
                });
            }

            function createDiagnosticTabsAndContent(systems) {
                const tabsContainer = document.getElementById('diagnostic-tabs');
                const contentContainer = document.getElementById('diagnostic-content');
                tabsContainer.innerHTML = '';
                contentContainer.innerHTML = '';

                systems.forEach(system => {
                    const tab = document.createElement('button');
                    tab.textContent = system.name;
                    tab.dataset.tabId = system.id;
                    tab.className = 'tab-inactive py-2 px-4 -mb-px border-t border-l border-r rounded-t-lg text-sm md:text-base flex-shrink-0';
                    tab.addEventListener('click', () => setActiveTab(system.id));
                    tabsContainer.appendChild(tab);

                    const content = document.createElement('div');
                    content.id = `content-${system.id}`;
                    content.className = 'hidden';
                    
                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
                    
                    system.checks.forEach(check => {
                        const card = document.createElement('div');
                        card.className = 'bg-gray-50 p-4 rounded-lg border border-gray-200';
                        card.innerHTML = `<h4 class="font-semibold text-gray-800">${check.title}</h4><p class="text-sm text-gray-600 mt-1">${check.details}</p>`;
                        grid.appendChild(card);
                    });
                    
                    content.appendChild(grid);
                    contentContainer.appendChild(content);
                });
            }

            function createMaintenanceCards(maintenanceItems) {
                const container = document.getElementById('maintenance-cards');
                container.innerHTML = '';
                maintenanceItems.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'bg-blue-50 p-4 rounded-lg border border-blue-100 flex flex-col items-center text-center h-full';
                    card.innerHTML = `<div class="text-4xl mb-2">${item.icon}</div><h4 class="font-semibold text-gray-800">${item.title}</h4><p class="text-sm text-gray-600 mt-1">${item.details}</p>`;
                    container.appendChild(card);
                });
            }
            
            function setActiveTab(tabId) {
                activeTabId = tabId;
                document.querySelectorAll('#diagnostic-tabs button').forEach(tab => {
                    tab.classList.toggle('tab-active', tab.dataset.tabId === tabId);
                    tab.classList.toggle('tab-inactive', tab.dataset.tabId !== tabId);
                });
                document.querySelectorAll('#diagnostic-content > div').forEach(content => {
                    content.classList.toggle('hidden', content.id !== `content-${tabId}`);
                });
            }

            function toggleSymptom(symptomId, button) {
                button.classList.toggle('symptom-btn-active');
                button.classList.toggle('symptom-btn-inactive');
                if (activeSymptoms.has(symptomId)) {
                    activeSymptoms.delete(symptomId);
                } else {
                    activeSymptoms.add(symptomId);
                }
                updateChartAndRecommendations();
            }

            function updateChartAndRecommendations() {
                const T = translations[currentLanguage];
                const causeScores = {};
                T.systems.forEach(s => causeScores[s.id] = 0);

                if (activeSymptoms.size > 0) {
                    activeSymptoms.forEach(symptomId => {
                        const symptom = T.symptoms.find(s => s.id === symptomId);
                        symptom.causes.forEach(causeId => {
                            causeScores[causeId] += 1;
                        });
                    });
                }
                
                const scores = T.systems.map(s => causeScores[s.id]);
                chart.data.datasets[0].data = scores;
                chart.update();

                const maxScore = Math.max(...scores);
                if (maxScore > 0) {
                    const topCause = T.systems.find(sys => causeScores[sys.id] === maxScore);
                    if (topCause) {
                       setActiveTab(topCause.id);
                    }
                }
            }

            function createChart(T) {
                const ctx = document.getElementById('symptom-chart').getContext('2d');
                const labels = T.systems.map(s => s.name.split('(')[0].trim());
                const initialData = T.systems.map(s => 0);
                
                chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: T.chartLabel,
                            data: initialData,
                            backgroundColor: 'rgba(199, 125, 85, 0.2)',
                            borderColor: 'rgba(199, 125, 85, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(199, 125, 85, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(199, 125, 85, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                                grid: { color: 'rgba(0, 0, 0, 0.1)' },
                                pointLabels: { font: { size: 12 }, color: '#333' },
                                suggestedMin: 0,
                                suggestedMax: 3,
                                ticks: { stepSize: 1, backdropColor: 'transparent' }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw}`;
                                    }
                                }
                            }
                        }
                    }
                });
                updateChartAndRecommendations();
            }

            function initializeApp() {
                document.getElementById('lang-zh').addEventListener('click', () => {
                    currentLanguage = 'zh';
                    renderContent(currentLanguage);
                });
                document.getElementById('lang-en').addEventListener('click', () => {
                    currentLanguage = 'en';
                    renderContent(currentLanguage);
                });
                renderContent(currentLanguage);
            }

            initializeApp();
        });
    </script>
</body>
</html>
