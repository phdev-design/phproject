<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Godot Coordinate Tutorial: Why Do My Objects Fly Away?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #1a202c;
            color: #e2e8f0;
            transition: font-family 0.3s ease-in-out;
        }
        .font-en { font-family: 'Roboto', sans-serif; }
        .font-zh { font-family: 'Noto Sans TC', sans-serif; }
        .container-box {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            position: absolute;
            transition: all 0.5s ease-in-out;
        }
        .object-box {
            border: 2px solid;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        }
        .code-block {
            background-color: #2d3748;
            border-left: 4px solid #4fd1c5;
            color: #e2e8f0;
            font-family: 'Courier New', Courier, monospace;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .log-item {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .lang-btn.active {
            background-color: #4fd1c5;
            color: #1a202c;
        }
    </style>
</head>
<body class="p-4 md:p-8 font-en">

    <div class="max-w-5xl mx-auto">
        <header class="relative text-center mb-12">
            <div class="absolute top-0 right-0">
                <div class="flex rounded-lg bg-slate-700 p-1">
                    <button id="lang-en" class="lang-btn px-3 py-1 text-sm font-semibold rounded-md active">EN</button>
                    <button id="lang-zh" class="lang-btn px-3 py-1 text-sm font-semibold rounded-md">ç¹é«”</button>
                </div>
            </div>
            <h1 data-lang-key="main_title" class="text-4xl md:text-5xl font-bold text-teal-300 mb-2">Godot Coordinate Tutorial</h1>
            <p data-lang-key="subtitle" class="text-xl md:text-2xl text-slate-300">Why Do My Objects Fly Away?</p>
        </header>

        <main>
            <!-- Introduction -->
            <section class="mb-12 bg-slate-800 p-6 rounded-lg shadow-xl">
                <h2 data-lang-key="problem_title" class="text-2xl font-bold text-teal-300 mb-4 border-b-2 border-teal-400 pb-2">The Problem</h2>
                <p data-lang-key="problem_desc" class="text-lg leading-relaxed">Have you ever encountered this situation? You chop down a tree in your game, eagerly waiting for it to drop a log, but instead, the log instantly teleports to a far, distant location? This is a classic problem for Godot beginners, and its root lies in understanding the coordinate system.</p>
            </section>

            <!-- Core Concepts -->
            <section class="mb-12 bg-slate-800 p-6 rounded-lg shadow-xl">
                <h2 data-lang-key="concepts_title" class="text-2xl font-bold text-teal-300 mb-4 border-b-2 border-teal-400 pb-2">Core Concepts: Local vs. Global Position</h2>
                <div class="grid md:grid-cols-2 gap-6 text-lg">
                    <div class="bg-slate-700 p-4 rounded">
                        <h3 class="font-semibold text-xl mb-2">ğŸ“ <code class="text-pink-400">position</code> (Local Position)</h3>
                        <p data-lang-key="concept_local_desc">A node's position relative to its "parent" node. It's like your position in a room, measured from the corner of that room.</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded">
                        <h3 class="font-semibold text-xl mb-2">ğŸŒ <code class="text-pink-400">global_position</code> (Global Position)</h3>
                        <p data-lang-key="concept_global_desc">A node's absolute position in the entire game world. It's like your latitude and longitude on Earth, measured from a fixed world origin.</p>
                    </div>
                </div>
            </section>

            <!-- Interactive Simulation -->
            <section class="mb-12">
                <h2 data-lang-key="sim_title" class="text-2xl font-bold text-center text-teal-300 mb-4">Interactive Simulation</h2>
                <div class="bg-slate-800 p-6 rounded-lg shadow-xl">
                    <div id="simulation-area" class="relative w-full h-96 bg-slate-900 rounded-lg overflow-hidden mb-6 border-2 border-slate-700">
                        <div id="world-container" class="container-box top-0 left-0 w-full h-full">
                            <span class="absolute top-1 left-2 text-xs text-slate-400">World (0, 0)</span>
                        </div>
                        <div id="level-container" class="container-box" style="top: 20%; left: 15%; width: 70%; height: 60%;">
                             <span id="level-label" class="absolute top-1 left-2 text-xs text-slate-400">Level (Local: 72, 77)</span>
                        </div>
                        <div id="tree" class="object-box bg-green-600 border-green-400" style="top: 45%; left: 45%; width: 40px; height: 40px;">ğŸŒ³</div>
                        <div id="log" class="object-box bg-yellow-700 border-yellow-500 hidden" style="width: 25px; height: 25px;">ğŸªµ</div>
                    </div>
                    
                    <div class="flex justify-center gap-4 mb-6">
                        <button id="wrong-btn" data-lang-key="btn_wrong" class="btn bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Simulate Incorrect Code</button>
                        <button id="correct-btn" data-lang-key="btn_correct" class="btn bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg">Simulate Correct Code</button>
                        <button id="reset-btn" data-lang-key="btn_reset" class="btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Reset</button>
                    </div>
                    
                    <div id="explanation-log" class="p-4 rounded-lg bg-slate-900 h-48 overflow-y-auto font-mono text-sm">
                        <p data-lang-key="log_initial" class="text-slate-400">Click a button to start the simulation...</p>
                    </div>
                </div>
            </section>

            <!-- The Solution -->
            <section class="mb-12">
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-red-900/50 border border-red-500 p-6 rounded-lg">
                        <h3 data-lang-key="solution_wrong_title" class="text-2xl font-bold text-red-300 mb-3">âŒ The Incorrect Way</h3>
                        <p data-lang-key="solution_wrong_desc" class="mb-4">Set position first, then add to scene tree.</p>
                        <div class="code-block p-4 rounded">
<pre><code>func add_log_scene():
    var log = log_scene.instantiate()
    
    # Error! `log` is not in the scene yet.
    # Setting global_position has no effect.
    log.global_position = self.global_position
    
    get_parent().add_child(log)</code></pre>
                        </div>
                        <p data-lang-key="solution_wrong_result" class="mt-4 text-red-200"><strong>Result:</strong> When `add_child` is called, Godot sets the log's local `position` to `(0,0)` because the previous global position assignment was invalid. This causes the log to appear at its parent's origin, not at the tree's location.</p>
                    </div>
                    
                    <div class="bg-green-900/50 border border-green-500 p-6 rounded-lg">
                        <h3 data-lang-key="solution_correct_title" class="text-2xl font-bold text-green-300 mb-3">âœ… The Correct Solution</h3>
                        <p data-lang-key="solution_correct_desc" class="mb-4">Add to scene tree first, then set global position.</p>
                        <div class="code-block p-4 rounded">
<pre><code>func add_log_scene():
    var log = log_scene.instantiate()
    
    # 1. Correct: Add `log` to the scene tree first.
    get_parent().add_child(log)
    
    # 2. After it's part of the scene,
    #    set its global_position.
    log.global_position = self.global_position</code></pre>
                        </div>
                        <p data-lang-key="solution_correct_result" class="mt-4 text-green-200"><strong>Result:</strong> When setting `global_position`, Godot knows who the log's parent is. It can then correctly calculate the required local `position` to place it precisely at the tree's location.</p>
                    </div>
                </div>
            </section>

            <!-- Summary -->
            <section class="text-center bg-slate-800 p-8 rounded-lg shadow-xl">
                <h2 data-lang-key="summary_title" class="text-3xl font-bold text-teal-300 mb-4">The Golden Rule</h2>
                <p data-lang-key="summary_desc" class="text-xl max-w-3xl mx-auto leading-relaxed">When you need to dynamically create an object and place it at a specific location in the world, always remember this order:</p>
                <div class="mt-6 text-2xl font-bold text-yellow-300 bg-slate-900 p-4 rounded-md inline-block">
                    First `add_child()`, then set `global_position`.
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- Translation Data ---
        const translations = {
            en: {
                main_title: "Godot Coordinate Tutorial",
                subtitle: "Why Do My Objects Fly Away?",
                problem_title: "The Problem",
                problem_desc: "Have you ever encountered this situation? You chop down a tree in your game, eagerly waiting for it to drop a log, but instead, the log instantly teleports to a far, distant location? This is a classic problem for Godot beginners, and its root lies in understanding the coordinate system.",
                concepts_title: "Core Concepts: Local vs. Global Position",
                concept_local_desc: "A node's position relative to its \"parent\" node. It's like your position in a room, measured from the corner of that room.",
                concept_global_desc: "A node's absolute position in the entire game world. It's like your latitude and longitude on Earth, measured from a fixed world origin.",
                sim_title: "Interactive Simulation",
                btn_wrong: "Simulate Incorrect Code",
                btn_correct: "Simulate Correct Code",
                btn_reset: "Reset",
                log_initial: "Click a button to start the simulation...",
                solution_wrong_title: "âŒ The Incorrect Way",
                solution_wrong_desc: "Set position first, then add to scene tree.",
                solution_wrong_result: "<strong>Result:</strong> When `add_child` is called, Godot sets the log's local `position` to `(0,0)` because the previous global position assignment was invalid. This causes the log to appear at its parent's origin, not at the tree's location.",
                solution_correct_title: "âœ… The Correct Solution",
                solution_correct_desc: "Add to scene tree first, then set global position.",
                solution_correct_result: "<strong>Result:</strong> When setting `global_position`, Godot knows who the log's parent is. It can then correctly calculate the required local `position` to place it precisely at the tree's location.",
                summary_title: "The Golden Rule",
                summary_desc: "When you need to dynamically create an object and place it at a specific location in the world, always remember this order:",
                level_label_prefix: "Level (Local:",
                log_1: "1. Instantiating `log`...",
                log_wrong_2: "2. <span class='text-red-400'>Error:</span> Setting `log.global_position` before adding to scene...",
                log_wrong_3: "   ...`log` has no parent, so the assignment is invalid.",
                log_wrong_4: "3. Calling `get_parent().add_child(log)`...",
                log_wrong_5: "   ...`log` is added to `Level` with a default local `position` of (0,0).",
                log_wrong_6: "4. <span class='text-red-300 font-bold'>Result:</span> The log appears at the Level's origin, not the tree's location!",
                log_correct_2: "2. <span class='text-green-400'>Correct:</span> Calling `get_parent().add_child(log)`...",
                log_correct_3: "   ...`log` is added to `Level` and becomes part of the scene.",
                log_correct_4: "3. <span class='text-green-400'>Correct:</span> Setting `log.global_position` to the tree's `global_position`...",
                log_correct_5: "   ...Godot automatically calculates the correct local `position`.",
                log_correct_6: "4. <span class='text-green-300 font-bold'>Result:</span> The log appears precisely at the tree's location!",
            },
            zh: {
                main_title: "Godot åº§æ¨™æ•™å­¸",
                subtitle: "ç‚ºä½•æˆ‘çš„ç‰©ä»¶æœƒé£›åˆ°å¤©é‚Šï¼Ÿ",
                problem_title: "å•é¡Œæƒ…å¢ƒ",
                problem_desc: "ä½ æ˜¯å¦ä¹Ÿé‡éé€™ç¨®æƒ…æ³ï¼šåœ¨éŠæˆ²ä¸­ç å€’ä¸€æ£µæ¨¹ï¼Œæ»¿å¿ƒæœŸå¾…åœ°çœ‹è‘—å®ƒæ‰è½æœ¨é ­ï¼Œçµæœæœ¨é ­å»ç¬é–“ç§»å‹•åˆ°ä¸€å€‹éå¸¸éå¸¸é™é çš„åœ°æ–¹ï¼Ÿé€™æ˜¯ä¸€å€‹ Godot æ–°æ‰‹ç¶“å¸¸é‡åˆ°çš„ç¶“å…¸å•é¡Œï¼Œè€Œå®ƒçš„æ ¹æºï¼Œå°±è—åœ¨å°ã€Œåº§æ¨™ç³»çµ±ã€çš„ç†è§£ä¸Šã€‚",
                concepts_title: "æ ¸å¿ƒæ¦‚å¿µï¼šæœ¬åœ°åº§æ¨™ vs. å…¨åŸŸåº§æ¨™",
                concept_local_desc: "ä¸€å€‹ç¯€é»ç›¸å°æ–¼å…¶ã€Œçˆ¶ç¯€é»ã€çš„ä½ç½®ã€‚å°±åƒä½ åœ¨ä¸€å€‹æˆ¿é–“è£¡çš„ä½ç½®ï¼Œæ˜¯ä»¥æˆ¿é–“çš„è§’è½ç‚ºåŸºæº–ã€‚",
                concept_global_desc: "ä¸€å€‹ç¯€é»åœ¨æ•´å€‹éŠæˆ²ä¸–ç•Œä¸­çš„çµ•å°ä½ç½®ã€‚å°±åƒä½ åœ¨åœ°çƒä¸Šçš„ç¶“ç·¯åº¦ï¼Œæ˜¯ä»¥ä¸€å€‹å›ºå®šçš„ä¸–ç•ŒåŸé»ç‚ºåŸºæº–ã€‚",
                sim_title: "äº’å‹•å¼æ¨¡æ“¬",
                btn_wrong: "æ¨¡æ“¬éŒ¯èª¤çš„ç¨‹å¼ç¢¼",
                btn_correct: "æ¨¡æ“¬æ­£ç¢ºçš„ç¨‹å¼ç¢¼",
                btn_reset: "é‡è¨­",
                log_initial: "é»æ“ŠæŒ‰éˆ•é–‹å§‹æ¨¡æ“¬...",
                solution_wrong_title: "âŒ éŒ¯èª¤çš„ä½œæ³•",
                solution_wrong_desc: "å…ˆè¨­å®šåº§æ¨™ï¼Œå†åŠ å…¥å ´æ™¯æ¨¹ã€‚",
                solution_wrong_result: "<strong>çµæœï¼š</strong>ç•¶ `add_child` æ™‚ï¼ŒGodot æœƒå°‡æœ¨é ­çš„æœ¬åœ°åº§æ¨™ `position` è¨­ç‚º `(0,0)`ï¼Œå› ç‚ºä¹‹å‰è¨­å®šçš„å…¨åŸŸåº§æ¨™ç„¡æ•ˆã€‚é€™å°è‡´æœ¨é ­å‡ºç¾åœ¨çˆ¶ç¯€é»çš„åŸé»ï¼Œè€Œä¸æ˜¯æ¨¹çš„ä½ç½®ã€‚",
                solution_correct_title: "âœ… æ­£ç¢ºçš„è§£æ±ºæ–¹æ¡ˆ",
                solution_correct_desc: "å…ˆåŠ å…¥å ´æ™¯æ¨¹ï¼Œå†è¨­å®šå…¨åŸŸåº§æ¨™ã€‚",
                solution_correct_result: "<strong>çµæœï¼š</strong>ç•¶è¨­å®š `global_position` æ™‚ï¼ŒGodot çŸ¥é“æœ¨é ­çš„çˆ¶ç¯€é»æ˜¯èª°ï¼Œå› æ­¤å¯ä»¥æ­£ç¢ºåœ°è¨ˆç®—å‡ºå®ƒæ‡‰è©²åœ¨çš„æœ¬åœ°åº§æ¨™ `position`ï¼Œè®“å®ƒç²¾æº–åœ°å‡ºç¾åœ¨æ¨¹çš„ä½ç½®ã€‚",
                summary_title: "é»ƒé‡‘æ³•å‰‡",
                summary_desc: "ç•¶ä½ éœ€è¦å‹•æ…‹ç”Ÿæˆä¸€å€‹ç‰©ä»¶ä¸¦å°‡å®ƒæ”¾ç½®åœ¨ä¸–ç•Œä¸Šçš„æŸå€‹ç‰¹å®šä½ç½®æ™‚ï¼Œè«‹æ°¸é è¨˜ä½é€™å€‹é †åºï¼š",
                level_label_prefix: "é—œå¡ (æœ¬åœ°:",
                log_1: "1. å»ºç«‹æœ¨é ­å¯¦ä¾‹ `log`...",
                log_wrong_2: "2. <span class='text-red-400'>éŒ¯èª¤ï¼š</span>åœ¨ `log` åŠ å…¥å ´æ™¯å‰ï¼Œè¨­å®š `log.global_position`...",
                log_wrong_3: "   ...æ­¤æ™‚ `log` æ²’æœ‰çˆ¶ç¯€é»ï¼Œè¨­å®šç„¡æ•ˆã€‚",
                log_wrong_4: "3. åŸ·è¡Œ `get_parent().add_child(log)`...",
                log_wrong_5: "   ...`log` è¢«åŠ å…¥åˆ° `Level` ä¸­ï¼Œå…¶ `position` ç‚ºé è¨­çš„ (0,0)ã€‚",
                log_wrong_6: "4. <span class='text-red-300 font-bold'>çµæœï¼š</span>æœ¨é ­å‡ºç¾åœ¨é—œå¡çš„åŸé»ï¼Œè€Œä¸æ˜¯æ¨¹çš„ä½ç½®ï¼",
                log_correct_2: "2. <span class='text-green-400'>æ­£ç¢ºï¼š</span>åŸ·è¡Œ `get_parent().add_child(log)`...",
                log_correct_3: "   ...`log` è¢«åŠ å…¥åˆ° `Level` ä¸­ï¼Œæˆç‚ºå ´æ™¯çš„ä¸€éƒ¨åˆ†ã€‚",
                log_correct_4: "3. <span class='text-green-400'>æ­£ç¢ºï¼š</span>è¨­å®š `log.global_position` ç‚ºæ¨¹çš„ `global_position`...",
                log_correct_5: "   ...Godot è‡ªå‹•è¨ˆç®—å‡ºæ­£ç¢ºçš„æœ¬åœ° `position`ã€‚",
                log_correct_6: "4. <span class='text-green-300 font-bold'>çµæœï¼š</span>æœ¨é ­ç²¾æº–åœ°å‡ºç¾åœ¨æ¨¹çš„ä½ç½®ï¼",
            }
        };

        let currentLang = 'en';

        const setLanguage = (lang) => {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.body.classList.remove('font-en', 'font-zh');
            document.body.classList.add(lang === 'en' ? 'font-en' : 'font-zh');

            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-zh').classList.toggle('active', lang === 'zh');
            
            updateLevelLabel();
        };

        // --- Simulation Logic ---
        const world = document.getElementById('world-container');
        const level = document.getElementById('level-container');
        const tree = document.getElementById('tree');
        const log = document.getElementById('log');
        const wrongBtn = document.getElementById('wrong-btn');
        const correctBtn = document.getElementById('correct-btn');
        const resetBtn = document.getElementById('reset-btn');
        const explanationLog = document.getElementById('explanation-log');
        const levelLabel = document.getElementById('level-label');

        const initialLogState = () => {
            log.classList.add('hidden');
            log.style.transition = 'all 1s ease-in-out';
            log.style.top = '50%';
            log.style.left = '50%';
            explanationLog.innerHTML = `<p data-lang-key="log_initial" class="text-slate-400">${translations[currentLang].log_initial}</p>`;
        };

        const logMessage = (key, color = 'text-slate-300') => {
            const p = document.createElement('p');
            p.className = `log-item ${color}`;
            p.innerHTML = translations[currentLang][key] || key;
            explanationLog.appendChild(p);
            explanationLog.scrollTop = explanationLog.scrollHeight;
        };

        const disableButtons = (disabled) => {
            wrongBtn.disabled = disabled;
            correctBtn.disabled = disabled;
            wrongBtn.classList.toggle('opacity-50', disabled);
            correctBtn.classList.toggle('opacity-50', disabled);
        };

        resetBtn.addEventListener('click', initialLogState);

        wrongBtn.addEventListener('click', () => {
            initialLogState();
            explanationLog.innerHTML = '';
            disableButtons(true);
            
            log.classList.remove('hidden');
            
            setTimeout(() => logMessage('log_1'), 100);
            setTimeout(() => logMessage('log_wrong_2'), 1000);
            setTimeout(() => logMessage('log_wrong_3'), 2000);
            setTimeout(() => logMessage('log_wrong_4'), 3000);
            setTimeout(() => {
                logMessage('log_wrong_5');
                const levelRect = level.getBoundingClientRect();
                const worldRect = world.getBoundingClientRect();
                log.style.top = `${levelRect.top - worldRect.top}px`;
                log.style.left = `${levelRect.left - worldRect.left}px`;
            }, 4000);
            setTimeout(() => {
                logMessage('log_wrong_6');
                disableButtons(false);
            }, 5500);
        });

        correctBtn.addEventListener('click', () => {
            initialLogState();
            explanationLog.innerHTML = '';
            disableButtons(true);

            log.classList.remove('hidden');

            setTimeout(() => logMessage('log_1'), 100);
            setTimeout(() => logMessage('log_correct_2'), 1000);
            setTimeout(() => {
                 logMessage('log_correct_3');
                 log.style.transition = 'none';
                 const levelRect = level.getBoundingClientRect();
                 const worldRect = world.getBoundingClientRect();
                 log.style.top = `${levelRect.top - worldRect.top}px`;
                 log.style.left = `${levelRect.left - worldRect.left}px`;
            }, 2000);
             setTimeout(() => {
                 log.style.transition = 'all 1s ease-in-out';
            }, 2100);
            setTimeout(() => logMessage('log_correct_4'), 3000);
            setTimeout(() => {
                logMessage('log_correct_5');
                const treeRect = tree.getBoundingClientRect();
                const worldRect = world.getBoundingClientRect();
                log.style.top = `${treeRect.top - worldRect.top}px`;
                log.style.left = `${treeRect.left - worldRect.left}px`;
            }, 4000);
             setTimeout(() => {
                logMessage('log_correct_6');
                disableButtons(false);
            }, 5500);
        });
        
        const updateLevelLabel = () => {
            const levelRect = level.getBoundingClientRect();
            const worldRect = world.getBoundingClientRect();
            levelLabel.textContent = `${translations[currentLang].level_label_prefix} ${Math.round(levelRect.left - worldRect.left)}, ${Math.round(levelRect.top - worldRect.top)})`;
        }

        // --- Event Listeners for Language Switch ---
        document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
        document.getElementById('lang-zh').addEventListener('click', () => setLanguage('zh'));
        
        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            setLanguage('en'); // Set default language
            initialLogState();
        });

    </script>
</body>
</html>
